#include "SAM4S4B/SAM4S4B.h"
#include <string.h>
#include <stdlib.h>
#include <stdio.h>

#define RESET_PIN    8

/*const char initialBoard[32][32] = {
 {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 0
 {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 1
 {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 2
  {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 3
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 4
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 5
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 6
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 7
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 8
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 9
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 10
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 11
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 12
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 13
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 14
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 15
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 16
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 17
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 18
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 19
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 20
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 21
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 22
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 23
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 24
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 25
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 26
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 27
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 28
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 29
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 30
  {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 31
};*/

const char initialBoard[32][32] = {
 {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 0
 {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 1
 {'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 2
  {'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 3
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 4
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 5
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 6
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 7
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 8
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 9
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 10
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 11
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 12
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 13
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 14
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 15
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 16
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 17
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 18
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 19
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 20
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 21
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 22
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 23
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 24
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 25
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 26
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 27
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 28
	{'#', '#', '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-',
	 '-', '-', '-', '-', '-','-', '-', '-', '-', '-', '-', '-', '-', '-', '#', '#'},  // 29
	{'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 30
  {'#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
	 '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'},  // 31
};


char stringToByte(char inputChar)
{
	char result;
	switch(inputChar) {
		case '#': 
			result = 0x01; // WALL: 0000_0111
			break;
		case '-':
			result = 0x02; // GRASS: 0000_0010
			break;
	}
	return result;
}


void sendLED()
{
	pioDigitalWrite(RESET_PIN, 1);
	pioDigitalWrite(RESET_PIN, 0);
	int i,j; 
	for (i = 0; i < 16; ++i){
		for (j = 0; j < 35; ++j){
			 char result;
			 if(j>=32){
				 result= 0x00;
			 }
			 else{
			 char top = stringToByte(initialBoard[i][j]);
			 char bot = stringToByte(initialBoard[i+16][j]);
			 result = (top<<3) | bot;
			 }
			 spiSend(result);
		}
	}		

}


int main(void)
{
  samInit();
	pioInit();
	tcInit();
	tcDelayInit();
	
	// "clock divide" = master clock frequency / desired baud rate
  // the phase for the SPI clock is 1 and the polarity is 0
	spiInit(5, 0, 1);
  
  pioPinMode(RESET_PIN, PIO_OUTPUT);
	
	uartInit(4,26); // no parity, a baud rate of 9600
	//uartInit(4,2); // 115200 
	pioDigitalWrite(RESET_PIN, 1);
	pioDigitalWrite(RESET_PIN, 0);
	while(1)
	{
		sendLED();
		//spiSendReceive(0x1F); // -> 00_011_111 		
		//spiSendReceive(0x12); // -> 00_010_010
    
		//spiSendReceive(0xFF);
		
	
	}
	//pioDigitalWrite(LOAD_PIN, 0);
}
